@model LibraryManagerPro.Models.ViewModels.LivroViewModel

@{
    ViewData["Title"] = "Detalhes do Livro";
    var relacionados = ViewBag.Relacionados as List<LibraryManagerPro.Models.ViewModels.LivroViewModel>;
}

<div class="container mt-4">
    <h2 class="mb-4">Detalhes do Livro</h2>

    <div class="card shadow-sm">
        @{
            var mainCapaUrl = !string.IsNullOrEmpty(Model.CapaUrl) 
                ? Model.CapaUrl 
                : "https://via.placeholder.com/300x400.png?text=Sem+Capa";
        }
        <img src="@mainCapaUrl" class="card-img-top" alt="Capa do Livro" style="max-height:350px; object-fit:cover;" />

        <div class="card-body">
            <h3 class="card-title fw-bold">@Model.Titulo</h3>
            <p class="card-text"><strong>Ano:</strong> @Model.AnoPublicacao</p>
            <p class="card-text"><strong>Preço:</strong> @Model.Preco.ToString("C")</p>
            <p class="card-text"><strong>Descrição:</strong> @Model.Descricao</p>

            <p class="card-text">
                <strong>Autores:</strong>
                @if (Model.AutoresNomes != null && Model.AutoresNomes.Any())
                {
                    <span>@string.Join(", ", Model.AutoresNomes)</span>
                }
                else
                {
                    <span class="text-muted">Nenhum autor vinculado</span>
                }
            </p>
        </div>

        <div class="card-footer text-center">
            <a asp-action="Index" class="btn btn-secondary">Voltar</a>
            @if (User.IsInRole("Admin"))
            {
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">Editar</a>
                <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-danger">Excluir</a>
            }
        </div>

        @* 🔥 Recomendação de livros relacionados *@
        @if (relacionados != null && relacionados.Any())
        {
            @* 🔥 Recomendação de livros relacionados *@
            @if (relacionados != null && relacionados.Any())
            {
                <div class="p-3">
                    <h4 class="mt-4">📖 Livros recomendados</h4>
                    <div class="row row-cols-1 row-cols-md-3 g-3">
                        @foreach (var rec in relacionados)
                        {
                            var recCapaUrl = !string.IsNullOrEmpty(rec.CapaUrl)
                            ? rec.CapaUrl
                            : "https://via.placeholder.com/200x300.png?text=Sem+Capa";

                            <div class="col">
                                <div class="card h-100 shadow-sm">
                                    <img src="@recCapaUrl" class="card-img-top" style="height:200px; object-fit:cover;" />
                                    <div class="card-body text-center">
                                        <h6 class="fw-bold">@rec.Titulo</h6>
                                        <a asp-action="Details" asp-route-id="@rec.Id" class="btn btn-outline-primary btn-sm">
                                            Ver Detalhes
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        }
    </div>
</div>